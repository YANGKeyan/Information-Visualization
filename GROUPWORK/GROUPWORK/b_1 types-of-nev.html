<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Energy Vehicle Types Bubble Chart</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 102vh;
        
            background-color: #f0f0f0;
    
        margin-left: 30px;
        margin-top: 20px;
    
        }

        text {
            font-family: Arial, sans-serif;
            font-weight: bold;
        }

        circle {
            cursor: pointer;
            transition: transform 0.3s ease;
           
        }

            circle:hover {
                transform: scale(1.05);
            }
                   /* è®¾ç½®æŒ‰é’®çš„æ ·å¼å’Œä½ç½® */
                   button {
        padding: 10px 20px;
        font-size: 16px;
        background-color: rgb(72, 141, 11);
        color: rgb(228, 233, 237);
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin-bottom: 10px;
        margin-right: 10px;
      }

      button:hover {
        background-color: #45a049;
      }
    </style>
</head>
<body>
    <h1 style="position: absolute; top: 0px; left: 30px; right: 400px;">2. New Energy Vehicle Technology</h1>
    <h2  style="position: absolute; top: 60px; left: 30px; right: 400px;color:#555;"> 2.1 Types of New Energy Vehicle</h2>
    <script>
        const imageMap = {
            "Electric Vehicles": "image1.png",
            "Battery Electric Vehicles": "image2.png",
            "Plug-in Hybrid Electric Vehicles": "image3.png",
            "Hydrogen Fuel Cell Vehicles": "image4.png",
            "Hybrid Electric Vehicles": "image5.png",
            "Compressed Natural Gas Vehicles": "image6.png",
            "Diesel-Electric Hybrid Vehicles": "image7.png"
        };
        function showImage(event, d) {
            const imageName = imageMap[d.data.name];
            if (imageName) {
                // è·å–å±å¹•çš„å®½åº¦å’Œé«˜åº¦
                const screenWidth = window.innerWidth;
                const screenHeight = window.innerHeight;

                // è®¡ç®—ä¸­å¿ƒä½ç½®
                const xPosition = 2*screenWidth / 3;
                const yPosition = screenHeight / 5;

                // å°†å›¾ç‰‡æ”¾ç½®åœ¨å±å¹•ä¸­å¿ƒ
                // éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå›¾ç‰‡çš„å·¦ä¸Šè§’å°†ä½äºå±å¹•ä¸­å¿ƒ
                // å¦‚æœæƒ³è¦å›¾ç‰‡çš„ä¸­å¿ƒä½äºå±å¹•ä¸­å¿ƒï¼Œéœ€è¦æ ¹æ®å›¾ç‰‡çš„å°ºå¯¸è¿›è¡Œè°ƒæ•´
                svg.append('image')
                    .attr('href', imageName)
                    .attr('x', xPosition - 50) // å‡è®¾å›¾ç‰‡å®½åº¦ä¸º100px
                    .attr('y', yPosition - 50) // å‡è®¾å›¾ç‰‡é«˜åº¦ä¸º100px
                    .attr('width', '500px') // å›¾ç‰‡å®½åº¦*
                    .attr('height', '500px') // å›¾ç‰‡é«˜åº¦
                    .attr('class', 'tooltip-image');
            }
        }

        // åˆ›å»ºé¼ æ ‡ç§»å¼€æ—¶ç§»é™¤å›¾ç‰‡çš„å‡½æ•°
        function hideImage() {
            svg.select('.tooltip-image').remove();
        }

        // ä¸ºæ¯ä¸ªåœ†æ·»åŠ æ‚¬åœäº‹ä»¶
        
        const data = {
            name: "New Energy Vehicles",
            children: [
                {
                    name: "Electric Vehicles",
                    children: [
                        { name: "Battery Electric Vehicles" },
                        { name: "Plug-in Hybrid Electric Vehicles" }
                    ]
                },
                { name: "Hydrogen Fuel Cell Vehicles" },
                { name: "Hybrid Electric Vehicles" },
                { name: "Compressed Natural Gas Vehicles" },
                { name: "Diesel-Electric Hybrid Vehicles" }
            ]
        };


        const width = window.innerWidth * 0.9;
        const height = window.innerHeight * 0.9;

        const svg = d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height);

        const root = d3.hierarchy(data)
            .sum(d => 1)
            .sort((a, b) => b.value - a.value);

        const bubbleLayout = d3.pack()
            .size([width, height])
            .padding(15);

        const nodes = bubbleLayout(root).descendants();

        // é¦–å…ˆï¼Œä¸ºæ¯ä¸ªå…ƒç´ ï¼ˆåœ†åœˆã€æ–‡æœ¬å’Œçº¿æ¡ï¼‰æä¾›æ•°æ®å¹¶åˆ›å»ºå…ƒç´ 
        const circles = svg.selectAll("circle")
            .data(nodes)
            .enter()
            .append("circle")
            .on('mouseover', showImage) // åœ¨æ­¤å¤„ç»‘å®šäº‹ä»¶
            .on('mouseout', hideImage);

        const lines = svg.selectAll("line")
            .data(nodes)
            .enter()
            .append("line");

        const texts = svg.selectAll("text")
            .data(nodes)
            .enter()
            .append("text");

        // ç„¶åï¼Œå®šä¹‰æ¯ä¸ªå…ƒç´ çš„å±æ€§
        circles
            .attr("cx", d => d.x)
            .attr("cy", d => d.y)
            .attr("r", d => d.r)
            .attr("fill", d => {
                switch (d.depth) {
                    case 1: return "lightblue";
                    case 2: return "lightgreen";
                    default: return "none";
                }
            })
            .attr("stroke", "#000")
            .attr("filter", "url(#drop-shadow)");

        lines
            .attr("x1", d => d.x)
            .attr("y1", d => {
                if (d.data.name === "Battery Electric Vehicles") {
                    return d.y + 20; // è°ƒæ•´è¿™ä¸ªå€¼ä»¥æ›´æ”¹ä½ç½®
                }
                return d.y;
            })
            .attr("x2", d => {
                const textDirection = d.x > width / 2 ? 1 : -1;
                return d.x + (d.r + 10) * textDirection;
            })
            .attr("y2", d => {
                if (d.data.name === "Battery Electric Vehicles") {
                    return d.y + 40; // è°ƒæ•´è¿™ä¸ªå€¼ä»¥æ›´æ”¹ä½ç½®
                }
                return d.y;
            })
            .attr("stroke", "black")
            .filter(d => d.data.name === "New Energy Vehicles")
            .remove();


        texts

            .style("font-size", d => {
                if (d.data.name === "New Energy Vehicles") {
                    return "25px"; // ä½ å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´è¿™ä¸ªå€¼
                }
                if (d.data.name === "Electric Vehicles") {
                    return "20px"; // ä½ å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´è¿™ä¸ªå€¼
                }
                return "16px"; // è¿™æ˜¯é»˜è®¤çš„å­—ä½“å¤§å°ï¼Œä½ å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´è¿™ä¸ªå€¼
            })
            
            .attr("x", d => {
                if (d.data.name === "New Energy Vehicles") {
                    return d.x + 180; // ä½¿ç”¨åœ†å¿ƒçš„xåæ ‡ä½œä¸ºåŸºç¡€
                }
                if (d.data.name === "Plug-in Hybrid Electric Vehicles") {
                    return d.x - 300; // ä½¿ç”¨åœ†å¿ƒçš„xåæ ‡ä½œä¸ºåŸºç¡€
                }

                if (d.data.name === "Electric Vehicles") {
                    return d.x + 100; // ä½¿ç”¨åœ†å¿ƒçš„xåæ ‡ä½œä¸ºåŸºç¡€
                }
                const textDirection = d.x > width / 2 ? 1 : -1;
                return d.x + (d.r + 15) * textDirection;
            })

            .attr("y", d => {
                if (d.data.name === "New Energy Vehicles") {
                    return d.y - 300; // ä½¿ç”¨åœ†å¿ƒçš„yåæ ‡ï¼Œå¹¶å‘ä¸‹ç§»åŠ¨é€‚å½“çš„è·ç¦»ï¼Œä½¿å…¶ä½äºçº¢è‰²åœ†åœˆå†…
                }
                if (d.data.name === "Battery Electric Vehicles") {
                    return d.y + 50;
                }
                

                if (d.data.name === "Electric Vehicles") {
                    return d.y - 150;
                }
                

                return d.y;
            })
            .attr("text-anchor", d => {
                if (d.data.name === "New Energy Vehicles") {
                    return "middle"; // è®¾ç½®æ–‡æœ¬å¯¹é½æ–¹å¼ä¸ºä¸­å¿ƒå¯¹é½
                }
                return d.x > width / 2 ? "start" : "end";
            })
            .attr("dy", "0.3em")
            .text(d => d.data.name);


        // Define filter to add shadow to bubbles
        const defs = svg.append("defs");

        const filter = defs.append("filter")
            .attr("id", "drop-shadow")
            .attr("height", "130%");

        filter.append("feGaussianBlur")
            .attr("in", "SourceAlpha")
            .attr("stdDeviation", 3)
            .attr("result", "blur");

        filter.append("feOffset")
            .attr("in", "blur")
            .attr("dx", 2)
            .attr("dy", 2)
            .attr("result", "offsetBlur");

        const feMerge = filter.append("feMerge");

        feMerge.append("feMergeNode")
            .attr("in", "offsetBlur");

        feMerge.append("feMergeNode")
            .attr("in", "SourceGraphic");
   
    </script>
</body>
<a href="A4.html">
    <button type="button" style="position: absolute; top: 750px; left: 30px;">ğŸ¡„ Previous</button>
</a>
<a href="./b_2 performance-of-nev.html">
    <button type="button" style="position: absolute; top: 750px; left: 170px;">Next ğŸ¡†</button>
</a>

</html>
